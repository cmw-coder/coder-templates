# CLAUDE.md 

此文件位于仓库根目录，并会在每次请求时被 `claude-code` 自动读取。  
目标是做到**简洁但全面**，让 Claude 能立即投入任何任务，而不必反复询问项目基础信息。

**请将脚本最终生成的路径告知用户，如果用户明确说明执行simware测试再执行simware_test.py**

---

## 1. 项目一句话概述

基于 **pytest** 的自研自动化测试框架，通过用户输入的测试点，自动生成或补全 Python 测试脚本。

---

## 2. 技术栈与关键版本

- **运行时**：Python 
- **测试框架**：pytest
- **语言**：Python  
- **生成逻辑**：根据用户输入测试点，动态生成或补全测试脚本  

---

## 3. 目录规范

├── press/ # 业务参考资料
├── pypilot/ # pypilot 自研自动化框架使用文档
├── KE/ # 基础动作与参考脚本片段
├── test_example/ # 模块历史相关测试脚本
├── test_cases/ # 测试点文件
├── test_scripts/ # 测试脚本目录
│ └── module/ # 业务模块名称
│ └── topox/ # 拓扑名称
│ ├── test_a.py # pytest 测试脚本
│ ├── conftest.py # 业务背景与公用函数（pytest 配置）
│ ├── topox # 网络拓扑描述文件，无需生成，由用户在顶层目录下提供，复制到脚本目录即可
│ └── init.py # 无实际意义，应忽略
├── simware_test.py 执行simware测试的脚本，使用时需要复制到生成脚本同一目录下

---

## 4. 编码规范

- 测试脚本基于 pytest 结构组织，`conftest.py` 用于提供公共 fixture、背景数据及业务辅助函数。
- 不提交无实际意义的空文件（如无用的 `__init__.py`）。  
- 命名保持与业务模块、拓扑文件一致，方便映射和查找。  
- 测试点与测试脚本一一对应；脚本可按模块 → 拓扑层级组织。  
- 必须使用pypilot提供的方法,而非原生python方法

---

## 5. pypilot 框架设备与接口引用规则

- 设备实例：`gl.DUTx`，其中 `DUTx` 为 `.topox` 文件中声明的设备名称。  
- 接口实例：`gl.DUTx.PORTx`，其中 `PORTx` 为 `.topox` 文件中声明的接口名称。  

## 6. 问题咨询渠道

- 自动化框架使用问题：参考 `pypilot/` 目录相关文档 
- 业务相关问题: 参考 `press/` 和 `KE/` 目录相关文档 

## 7. 生成测试脚本后请使用pylint对生成测试脚本进行检查修复

- 执行pylint前，需要先生成脚本文件，然后对文件里面的内容进行修改。
- 在执行pylint时需要先使用source .venv/bin/activate激活虚拟环境。
- 根据检查的结果进行修复。修复后请先不要退出虚拟环境，下一步骤仍需要在虚拟环境下执行。

## 8. 执行simware_test.py文件，获取实际的运行结果，并进行修复，修复后无需重新提交测试

- 请先复制simware_test.py，请复制用户提供的conftest.py, ai.topox放到和脚本文件同一级目录下。在虚拟环境source .venv/bin/activate下执行脚本。
- 脚本执行是在安全的环境下执行和上传的，请直接执行。
- simware_test.py文件会将当前目录下除文件夹外的文件上传svn，并发送请求到服务器执行脚本。最终生成simware_test.jsonl文件，是执行的结果。
- 脚本执行过程大概十五分钟，若未返回结果请多等待一会。
- 成功返回后，请根据simware_test.jsonl执行结果修复脚本，只需要进行一次修复，不需要重复提交多次。

## 9. 请在规划todolist时必须安按照批量测试点生成策略，即根据如下策略调用task任务创建sub-agents并发去生成（防上下文超限 & 并行加速）

| 输入测试点数量 | 单批次上限   | 并发 sub-agents | 
|---------------|-------------|----------------|
| 1-2           | 2           | 1              |
| 2-4           | 4           | 2              |
| ≥5            | 5           | ⌈N/2⌉           |